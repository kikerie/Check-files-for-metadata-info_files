var rating;function submitRating(value){trackValue=Number(value)+1;_paq.push(['trackGoal',trackValue]);$("#ratings-area").html("<div class='text-center'><b>"+Translator.trans("Thank you for your rating")+"</b></div>");rating=value;}
window.onload=checkJobStatus(downloadResultJobId);$(document).on('click',"button#sendfeedback",function(){if($('#feedback').val()==""){alert(Translator.trans("Please enter some text in comment box"));}else{$(this).attr('disabled','disabled');$(this).val(Translator.trans("Please Wait..."));$.post({url:sendFeedbackURL,async:true,dataType:"json",data:$("FORM#frmFeedback").serialize()+"&rating="+rating,success:function(){$("FORM#frmFeedback").addClass('hide');$("DIV#success").removeClass('hide');$("DIV#success").addClass('alert alert-success');},error:function(){throwAjaxError();}});}});function checkJobStatus(downloadResultJobId,edit){$("#jobId").val(downloadResultJobId);$.get({url:checkJobStatusUrl,async:true,data:{'jobId':downloadResultJobId},dataType:"json",cache:false,success:function(response){if(response.jobStatus=='processing'){setTimeout(function(){checkJobStatus(downloadResultJobId,edit);},1000);}else if(response.jobStatus=='completed'||response.jobStatus=='failed'){if(edit==true){getEditedFile(downloadResultJobId,response.jobStatus);return false;}
getMetaDataResult(downloadResultJobId);}}});}
function getMetaDataResult(){$.get({url:getMetaDataListURL,async:true,success:function(response){$("#meta-result #meta-div").html(response);},error:function(error){throwFetchMetaDataProcessFailedError(error);}});}
function throwFetchMetaDataProcessFailedError(data){$('.ajax-loader').css('display','none');var errorMessage1=Translator.trans('Sorry, something went wrong. Please try again, or refresh the page.'),errorBRtag1="<br>",errorMessage3=Translator.trans("Or your file is protected by a password."),mailMessage1=Translator.trans('Or send us a mail to')+" ",mailMessage2=Translator.trans('Send us an e-mail'),mailMessage3="'nbjmup;ujnf3ifmqAnfubebub3hp/dpn'",mailMessage4='<a title= " '+mailMessage2+' " href="javascript:linkTo_UnCryptMailto('+mailMessage3+','+' 1'+');"> time2help@metadata2go.com</a>',mailmessage=mailMessage1.concat(mailMessage4);var errorMessage=errorMessage1.concat(errorBRtag1,errorBRtag1,errorMessage3);var downloadProgress=errorContainer=$("#meta-result #meta-div");if(downloadProgress.length==0&&errorContainer.length==0){var fileUpload=$('#fileupload');fileUpload.find("#cloudUrlMessage").html('<div class="alert alert-danger">'+Translator.trans("Oops! :( ")+errorMessage+'</div>').find('.alert').delay(10000).fadeOut('slow');}else{var failedMessage='';if(data.id!=''&&typeof data.id!='undefined'){failedMessage=Translator.trans("Your ticket-id for contact our support is:")+data.id.split('-')[0]+'<br>';}
errorContainer.html('<h1 class="text-center text-danger">'+Translator.trans("Oops! :(")+'</h1><br /><h4 class="text-center text-danger">'+errorMessage+'</h4><hr /><div class="text-center text-bold">'+failedMessage+Translator.trans("You can also contact us to speed up that process ;-)")+'<br />'+mailmessage+'</div>');}}
$(document).on('click',".editTag",function(){$(this).parent().find('input').attr('type','text');$(this).parent().parent().find('.metaValue').addClass('hidden');$(this).addClass('hidden');$(this).parent().find('.editCancel').removeClass('hidden');});$(document).on('click',".editCancel",function(){$(this).parent().find('input').attr('type','hidden');$(this).parent().parent().find('.metaValue').removeClass('hidden');$(this).addClass('hidden');$(this).parent().find('.editTag').removeClass('hidden');});$(document).on('click',"button#editMeta",function(){$("#editMeta").button('loading');$("#editMeta").prop('disabled',true);$.post({url:editMetaURL,async:true,dataType:"json",data:$("FORM#editForm input:text").serialize(),success:function(response){checkJobStatus(response.jobId,true);return false;},error:function(){alert(Translator.trans("Something went wrong please try again"));}});});function getEditedFile($jobId,jobStatus){if(jobStatus=="failed"){alert(Translator.trans("Something went wrong please try again"));$("#editMeta").button('reset');$("#editMeta").prop('disabled',false);return false;}
$.get({url:getEditedFileURL,async:true,dataType:"json",data:{'jobId':$jobId},cache:false,success:function(response){$("#downloadEditFile").attr('href',response.uri);$("#downloadEditFile").removeClass('hidden');$("#editMeta").button('reset');$("#editMeta").prop('disabled',false);$.each(response.failedMetaKeys,function(key,value){$("#"+value).removeClass('hidden');});return false;},error:function(){alert(Translator.trans("Something went wrong please try again"));}});}